# ç¨‹å¼ç¢¼é‡æ§‹èªªæ˜

## ğŸ“‹ é‡æ§‹æ¦‚è¿°

æœ¬æ¬¡é‡æ§‹å°‡åŸæœ¬åˆ†æ•£ä¸”é‡è¤‡çš„ç¨‹å¼ç¢¼é€²è¡Œæ¨¡çµ„åŒ–æ•´ç†ï¼Œæå‡å¯ç¶­è­·æ€§ã€å¯è®€æ€§å’ŒåŸ·è¡Œæ•ˆèƒ½ã€‚

## ğŸ¯ ä¸»è¦æ”¹é€²

### 1. æ¨¡çµ„åŒ–æ¶æ§‹

å»ºç«‹äº†çµ±ä¸€çš„ `utils` å·¥å…·æ¨¡çµ„ï¼Œé¿å…ç¨‹å¼ç¢¼é‡è¤‡ï¼š

```
scripts/
â”œâ”€â”€ utils/                          # å…±ç”¨å·¥å…·æ¨¡çµ„ â­ æ–°å¢
â”‚   â”œâ”€â”€ __init__.py                 # æ¨¡çµ„åˆå§‹åŒ–
â”‚   â”œâ”€â”€ config.py                   # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ logger.py                   # æ—¥èªŒç³»çµ±
â”‚   â”œâ”€â”€ parser.py                   # è³‡æ–™è§£æå‡½æ•¸
â”‚   â””â”€â”€ data_loader.py              # è³‡æ–™è¼‰å…¥å‡½æ•¸
â”‚
â”œâ”€â”€ batch_decode.py                 # æ‰¹æ¬¡è§£ç¢¼ â­ é‡æ§‹
â”œâ”€â”€ data_convert.py                 # è³‡æ–™è½‰æ› â­ é‡æ§‹
â””â”€â”€ query_stock.py                  # è‚¡ç¥¨æŸ¥è©¢ â­ é‡æ§‹
```

### 2. ç¨‹å¼ç¢¼å“è³ªæå‡

**ä¹‹å‰çš„å•é¡Œï¼š**
- âŒ ç›¸åŒçš„å‡½æ•¸åœ¨å¤šå€‹æª”æ¡ˆä¸­é‡è¤‡å¯¦ä½œ
- âŒ ç¼ºä¹çµ±ä¸€çš„éŒ¯èª¤è™•ç†
- âŒ æ²’æœ‰æ—¥èªŒç³»çµ±
- âŒ ç¡¬ç·¨ç¢¼çš„é…ç½®åƒæ•¸
- âŒ ç¨‹å¼ç¢¼çµæ§‹æ··äº‚

**ç¾åœ¨çš„å„ªå‹¢ï¼š**
- âœ… DRY åŸå‰‡ï¼šæ¯å€‹å‡½æ•¸åªå®šç¾©ä¸€æ¬¡
- âœ… çµ±ä¸€çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒç³»çµ±
- âœ… é›†ä¸­å¼é…ç½®ç®¡ç†
- âœ… æ¸…æ™°çš„æ¨¡çµ„åŒ–çµæ§‹
- âœ… æ›´å¥½çš„ç¨‹å¼ç¢¼å¯è®€æ€§

### 3. æ•ˆèƒ½å„ªåŒ–

- **å¤šç·šç¨‹/å¤šé€²ç¨‹**ï¼šå……åˆ†åˆ©ç”¨ CPU è³‡æº
- **æ™ºèƒ½è·³é**ï¼šè‡ªå‹•è·³éå·²è™•ç†çš„æª”æ¡ˆ
- **è¨˜æ†¶é«”å„ªåŒ–**ï¼šé€è¡Œè®€å–ï¼Œé¿å…ä¸€æ¬¡æ€§è¼‰å…¥å¤§æª”æ¡ˆ

## ğŸ“¦ æ–°æ¨¡çµ„èªªæ˜

### `utils/config.py` - é…ç½®ç®¡ç†

é›†ä¸­ç®¡ç†æ‰€æœ‰é…ç½®åƒæ•¸ï¼š

```python
# è·¯å¾‘é…ç½®
DATA_DIR = PROJECT_ROOT / 'data'
DECODED_DIR = DATA_DIR / 'decoded_quotes'
LIMIT_UP_FILE = DATA_DIR / 'lup_ma20_filtered.parquet'

# è™•ç†åƒæ•¸
DEFAULT_MAX_WORKERS = min(4, os.cpu_count() or 4)
PRICE_DECIMAL_DIVISOR = 10000
```

### `utils/logger.py` - æ—¥èªŒç³»çµ±

æä¾›çµ±ä¸€çš„æ—¥èªŒè¼¸å‡ºï¼š

```python
from utils import setup_logger

logger = setup_logger('my_module')
logger.info("è™•ç†ä¸­...")
logger.error("ç™¼ç”ŸéŒ¯èª¤")
```

### `utils/parser.py` - è³‡æ–™è§£æ

åŒ…å«æ‰€æœ‰è§£æå‡½æ•¸ï¼š

```python
from utils import parse_trade_line, parse_depth_line, parse_timestamp

# è§£æ Trade è³‡æ–™
trade_data = parse_trade_line(line, date_str)

# è§£æ Depth è³‡æ–™
depth_data = parse_depth_line(line, date_str)
```

### `utils/data_loader.py` - è³‡æ–™è¼‰å…¥

è™•ç†æ¼²åœæ¸…å–®å’Œè‚¡ç¥¨ç¯©é¸ï¼š

```python
from utils import load_limit_up_list, get_target_stocks

# è¼‰å…¥æ¼²åœæ¸…å–®
limit_up_dict = load_limit_up_list(LIMIT_UP_FILE)

# å–å¾—ç›®æ¨™è‚¡ç¥¨
target_stocks = get_target_stocks(limit_up_dict, '20251031')
```

## ğŸ”„ ä¸»è¦è…³æœ¬å°ç…§

### 1. æ‰¹æ¬¡è§£ç¢¼ç¨‹å¼

| èˆŠç‰ˆ | æ–°ç‰ˆ |
|------|------|
| `batch_decode_quotes.py` (384è¡Œ) | `batch_decode.py` (155è¡Œ) |
| å‡½æ•¸é‡è¤‡å®šç¾© | ä½¿ç”¨å…±ç”¨æ¨¡çµ„ |
| ç¡¬ç·¨ç¢¼é…ç½® | é›†ä¸­å¼é…ç½® |
| print è¼¸å‡º | çµ±ä¸€æ—¥èªŒç³»çµ± |

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# æ‰¹æ¬¡è§£ç¢¼æ‰€æœ‰æ—¥æœŸçš„ Quote æª”æ¡ˆ
python scripts/batch_decode.py
```

### 2. è³‡æ–™è½‰æ›ç¨‹å¼

| èˆŠç‰ˆ | æ–°ç‰ˆ |
|------|------|
| `convert_to_json.py` (363è¡Œ) | `data_convert.py` (290è¡Œ) |
| æ··äº‚çš„å‡½æ•¸å®šç¾© | æ¸…æ™°çš„æ¨¡çµ„åŒ–çµæ§‹ |
| ç¼ºå°‘éŒ¯èª¤è™•ç† | å®Œå–„çš„éŒ¯èª¤è™•ç† |

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# å°‡ Parquet è½‰æ›ç‚º JSON
python scripts/data_convert.py
```

### 3. è‚¡ç¥¨æŸ¥è©¢å·¥å…·

| èˆŠç‰ˆ | æ–°ç‰ˆ |
|------|------|
| `get_single_stock_data.py` (173è¡Œ) | `query_stock.py` (95è¡Œ) |
| é‡è¤‡å¯¦ä½œè§£æå‡½æ•¸ | ä½¿ç”¨å…±ç”¨è§£æå™¨ |
| ç°¡é™‹çš„è¼¸å‡º | æ¸…æ™°çš„æ—¥èªŒè¼¸å‡º |

**ä½¿ç”¨æ–¹å¼ï¼š**
```bash
# æŸ¥è©¢å–®ä¸€è‚¡ç¥¨è³‡æ–™
python scripts/query_stock.py 20251031 TSE 2330 --output console
python scripts/query_stock.py 20251125 OTC 8042 --output parquet
```

## ğŸ“Š ç¨‹å¼ç¢¼çµ±è¨ˆ

### ç¸½è¡Œæ•¸æ¸›å°‘

| é¡åˆ¥ | èˆŠç‰ˆ | æ–°ç‰ˆ | æ¸›å°‘ |
|------|------|------|------|
| å·¥å…·å‡½æ•¸ | åˆ†æ•£åœ¨å„æª”æ¡ˆ | é›†ä¸­åœ¨ utils/ (ç´„300è¡Œ) | - |
| æ‰¹æ¬¡è§£ç¢¼ | 384è¡Œ | 155è¡Œ | -60% |
| è³‡æ–™è½‰æ› | 363è¡Œ | 290è¡Œ | -20% |
| è‚¡ç¥¨æŸ¥è©¢ | 173è¡Œ | 95è¡Œ | -45% |

### ç¨‹å¼ç¢¼é‡è¤‡ç‡

- **èˆŠç‰ˆ**ï¼šç´„40%çš„ç¨‹å¼ç¢¼é‡è¤‡ï¼ˆè§£æå‡½æ•¸åœ¨å¤šå€‹æª”æ¡ˆä¸­é‡è¤‡ï¼‰
- **æ–°ç‰ˆ**ï¼š< 5%ï¼ˆå…±ç”¨æ¨¡çµ„æ¶ˆé™¤é‡è¤‡ï¼‰

## ğŸš€ ä½¿ç”¨æŒ‡å—

### 1. å®Œæ•´çš„è³‡æ–™è™•ç†æµç¨‹

```bash
# æ­¥é©Ÿ 1: æ‰¹æ¬¡è§£ç¢¼ Quote æª”æ¡ˆ
python scripts/batch_decode.py

# æ­¥é©Ÿ 2: è½‰æ›ç‚º JSON æ ¼å¼
python scripts/data_convert.py

# æ­¥é©Ÿ 3: æŸ¥è©¢ç‰¹å®šè‚¡ç¥¨ï¼ˆå¯é¸ï¼‰
python scripts/query_stock.py 20251031 TSE 2330 --output console
```

### 2. åªè™•ç†ç‰¹å®šæ—¥æœŸ

ä¿®æ”¹ `batch_decode.py` ä¸­çš„ `dates_to_process` åˆ—è¡¨å³å¯ã€‚

### 3. èª¿æ•´ä¸¦è¡Œè™•ç†æ•¸é‡

åœ¨ `utils/config.py` ä¸­ä¿®æ”¹ï¼š

```python
DEFAULT_MAX_WORKERS = 8  # é è¨­ç‚º min(4, CPUæ ¸å¿ƒæ•¸)
```

## ğŸ”§ é–‹ç™¼å»ºè­°

### æ·»åŠ æ–°åŠŸèƒ½

å¦‚æœéœ€è¦æ·»åŠ æ–°çš„è§£æé‚è¼¯ï¼š

1. åœ¨ `utils/parser.py` ä¸­æ·»åŠ è§£æå‡½æ•¸
2. åœ¨ `utils/__init__.py` ä¸­å°å‡ºå‡½æ•¸
3. åœ¨ä¸»è…³æœ¬ä¸­ä½¿ç”¨ `from utils import new_function`

### ä¿®æ”¹é…ç½®

æ‰€æœ‰é…ç½®åƒæ•¸éƒ½åœ¨ `utils/config.py` ä¸­ï¼Œä¿®æ”¹ä¸€æ¬¡å³å¯å…¨å±€ç”Ÿæ•ˆã€‚

### æ·»åŠ æ—¥èªŒ

```python
from utils import setup_logger

logger = setup_logger('module_name')
logger.info("è³‡è¨Šè¨Šæ¯")
logger.warning("è­¦å‘Šè¨Šæ¯")
logger.error("éŒ¯èª¤è¨Šæ¯")
```

## âš ï¸ å‘å¾Œå…¼å®¹æ€§

èˆŠç‰ˆè…³æœ¬ä»ç„¶ä¿ç•™åœ¨ `scripts/` ç›®éŒ„ä¸­ï¼Œä½†å»ºè­°ä½¿ç”¨æ–°ç‰ˆï¼š

| èˆŠç‰ˆï¼ˆä¿ç•™ï¼‰ | æ–°ç‰ˆï¼ˆæ¨è–¦ï¼‰ |
|-------------|-------------|
| `batch_decode_quotes.py` | `batch_decode.py` |
| `convert_to_json.py` | `data_convert.py` |
| `get_single_stock_data.py` | `query_stock.py` |

å¯ä»¥åœ¨ç¢ºèªæ–°ç‰ˆç©©å®šå¾Œåˆªé™¤èˆŠç‰ˆã€‚

## ğŸ“ å¾…è¾¦äº‹é …

- [ ] æ·»åŠ å–®å…ƒæ¸¬è©¦
- [ ] æ·»åŠ å‘½ä»¤è¡Œé€²åº¦æ¢
- [ ] æ”¯æ´å¢é‡è™•ç†
- [ ] æ·»åŠ è³‡æ–™é©—è­‰åŠŸèƒ½
- [ ] å»ºç«‹é…ç½®æª”æ¡ˆï¼ˆYAML/JSONï¼‰

## ğŸ‰ ç¸½çµ

æœ¬æ¬¡é‡æ§‹é¡¯è‘—æå‡äº†ç¨‹å¼ç¢¼å“è³ªï¼š

- âœ… **å¯ç¶­è­·æ€§**: æ¨¡çµ„åŒ–è¨­è¨ˆï¼Œæ˜“æ–¼æ“´å±•å’Œç¶­è­·
- âœ… **å¯è®€æ€§**: æ¸…æ™°çš„çµæ§‹å’Œçµ±ä¸€çš„é¢¨æ ¼
- âœ… **å¯é æ€§**: å®Œå–„çš„éŒ¯èª¤è™•ç†å’Œæ—¥èªŒ
- âœ… **æ•ˆèƒ½**: å¤šç·šç¨‹ä¸¦è¡Œè™•ç†ï¼Œæ™ºèƒ½è·³éå·²è™•ç†æª”æ¡ˆ
- âœ… **ç°¡æ½”æ€§**: æ¶ˆé™¤é‡è¤‡ç¨‹å¼ç¢¼ï¼Œæ¸›å°‘ç¸½è¡Œæ•¸

---

**Version**: 1.0.0
**Date**: 2025-11-28
**Author**: Claude Code
